# 五子棋竞技场思路



## 4/13

建表：

1.User table：存放用户数据，包括：id，昵称（唯一昵称），注册凭证：手机号码或者邮箱二选一，密码；

2.Gamer table：存放游戏数据信息，包括：Gamer_id，段位、战绩、胜率、游玩场次数、胜场数，是否位于房间中

3.HistoricGame table：存放历史对局信息：包括：对局id（对局开始时间（包括年月日时分秒组成）与顺序生产的3位数字组成，共17位），对局起止时间、对战信息（对手，对战结果）

4.RealTimeGame table：存放实时对局信息，包括：对局id（对局开始时间（包括年月日时分秒组成）与顺序生产的3位数字组成，共17位），棋子位置（要存放两个人的数据），对局开始时间，对局玩家信息，用户在线情况

5.Room table：存放房间数据，包括：房间号（月份加日期和4位随机数字），是否公开，房间密码（不公开则为空字符串），房主id，嘉宾id

6.chessstyle：将对局与最终棋盘样式关联，包括：id：对局id，finalchessstyle：最终棋盘样式的id，由对局结束时间（包括年月日时分秒）和对局id的最后四位组成，共17位

7.chessStyle：将对局与棋盘进行关联，包括：id(对局id)，finalchessstyle_id(27位)棋盘样式id（最终棋盘样式实际上时更新到胜负分晓后的棋盘样式）





User与Gamer通过id外键连接，

HistoricGame 与Gamer 通过Gamer_with_HistoricGame表关联,通过game_id与棋盘最终样式关联

RealTimeGame与HIstoricGame通过对局id进行关联，通过game_id与实时棋盘样式关联

Room通过Gamer_id与Gamer相关联





**为了解决棋盘数据庞大导致查询时间过长，采用动态创建棋盘表的方式：**

**棋盘：数据库名由对局id+chess_style(27位)组成**

​		**包括：chess_possion**

**棋子:包括：棋子id（判断第几步，自动更新），棋子坐标chess_possion（char（2）），八个方位的Boolean值（forward,rear,left,right,leftfront,leftrear,rightfront,rightrear）**





解决快速判断棋子是否连成一条线的方法：在棋子周围设置8个方位为boolean值，如果为true则记录对应方向并向对应方向进行延申，并设置一个计数器，如果计数器达到5则判为胜





## 4/14

前后端代码组成：

**前端：**

1.login界面：实现登录功能（和login界面可以互相跳转）

2.register界面：实现注册功能

3.gameMajor界面：实现主界面菜单功能（包括创建房间功能、加入房间功能、个人信息查看功能、段位首页显示、快速匹配功能）（gameMajor界面可以和房间界面进行交互，对战界面只能在确认进入游戏时选择是否进入，选择否则返回主界面，选择是则跳转到游戏界面且只有在游戏结束（认输或则败时才能回到主界面）

4.房间界面：包括房间号显示，房间密码设置和更改，

5.对战界面：包括显示棋盘，判断先后手，实时显示棋盘，判断胜负，显示下棋时间，倒计时功能，检测是否在线，实现认输功能

6.更改密码：

**后端（实现数据交互与判断）：**

1.用户功能：注册、登录、修改密码

2.玩家功能：段位展示与更新、战绩展示与更新

3.游戏功能：**判断是否胜利**：通过设置棋子的是否具有连线成功的潜力进行判断（0：棋子没有连线成功的潜力，即以4颗棋子为半径的范围内的每条线都存在白棋，先读取一个方位的遇到的第一颗白棋位置，再在相反方位读取（5-1+i）颗棋子判断是否有白棋，若没有，且存在空的格子，则将潜力设置为1（如果能够顺利填满该线则可以成功连线）若已经在一个方向上存在5颗棋子则设置为2，并判断胜利），对局数据保存，断线重连功能（重连时间应该比下棋时间短）



为了正确游玩五子棋，对规则进行查阅得知一些规则：**PASS权**‌：除前五手外，双方均可选择放弃行棋（PASS），但需由对方继续落子后才能恢复行棋权利;‌**长连无效**‌：若一方形成六子或以上的“长连”，黑棋判负（禁手），白棋无此限制。**三三禁手**‌：一子同时形成两个或以上的“活三”（即未阻挡的三连）;**四四禁手**‌：一子同时形成两个或以上的“四”（包括活四或冲四)；若禁手与五连同时形成，禁手失效，判黑方胜。‌**三手可交换**‌：黑方下完前三手后，白方可选择交换执黑或继续执白，‌**五手两打**‌：黑方第五手需在棋盘上放置两枚棋子（位置不对称），由白方选择保留一枚继续对弈，禁手后：**立即判负**：如果黑方落子后形成禁手，且被白方（或裁判）当场指出并确认，则黑方直接输掉比赛。**白方需主动指出**：禁手需由白方在落下一手前指出才有效（若白方未发现而继续落子，禁手可能不再追究）。**禁止落子**：黑方不能主动选择形成禁手的落点（若故意走禁手点，直接判负）。





经分析，项目实现应为以下：

![1744632346536](C:\Users\Pumpkin\AppData\Roaming\Typora\typora-user-images\1744632346536.png)

需要开辟一个主服务器对用户传递的数据进行传输，难点在于如何实现绑定用户a和用户b的连接通道，既然要和多个用户进行通信，就需要使用多线程管理用户，由于有快速匹配和创建房间两种模式，因此分开讨论：

快速匹配：快速匹配时匹配随机的同样处于匹配队列的玩家，因此需要一个匹配队列的容器，在容器中存放处于匹配状态下的用户的ip和端口号，在匹配过程中选择死循进行匹配直到用户点击取消匹配或者成功获取其他玩家的ip并进行绑定，绑定方式为使用容器进行绑定

房间模式：房主在创建房间时向服务器提交房间号后创建唯一的房间容器进行容纳用户ip和端口号，当收到其他用户的加房请求时将该用户的ip和端口号添加到容器中，实现绑定

依照此思想可以使用Map集合进行绑定，在key中放置随机匹配的某个用户~~的id~~或者房主~~id~~  的socket，在value中存放另一个用户的~~ip和端口号~~  socket。